<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="img/favicon.html">

    <title>记录</title>

    <!-- Bootstrap core CSS -->
    <!--<link href="css/bootstrap.min.css" rel="stylesheet">-->
    <link href="//cdn.bootcss.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
    	.label-mini{
    		padding: 0.25em 0.4em;
    	}    	
    	.btn{
    		margin: 0 4px 0 0;
    	}
    	.btn-add{    		
		    float: right;
		    padding: 3.5px 8px;
    		margin: -3.5px 0 0 0;
    	}
    	.modal-dialog{
    		padding: 0;
    	}
    	.panel-body{/*同上*/
    		padding: 0;
    	}
  		.popover{
  			width: 225px;
  		}
  		.btn-info-g{
  			background-color: #fff;
  			color: #58c9f3;
  			border-color: #58c9f3;
  		}
  		.selected{
  			background-color: #58c9f3;
  			color: #fff;
  		}
  		.panel-heading-xs{
  			padding: 5px 15px;
  		}   	
  		.select-cz{
  			position: relative;
  			display: block;
  		}
  		.select-cz select{
  			position: absolute;
  			z-index: 1;
  		}
  		.label-icon{
  			border-radius: 0;
		    padding-left: 0.4em;
		    padding-right: 0.3em;
  		}
  		.table-striped>tbody>tr>td:first-child,.table-striped>thead>tr>th:first-child{
  			padding-left: 0;
  			padding-right: 0;
    		width: 20px;
  		}
  		.span-i{
  			color: #aaa;
    		padding: 0 3px;
  		}
  		.span-m{
  			color: #FCB322;
  			padding: 0 3px;
  		}
  		.table thead > tr > th, .table tbody > tr > th, .table tfoot > tr > th, .table thead > tr > td, .table tbody > tr > td, .table tfoot > tr > td {
			    padding: 8px 5px;
			}
  		
    </style>
  </head>

  <body>

  <section id="container" class="">
      <!--header start-->
      <header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-original-title="菜单" data-placement="right" class="icon-reorder tooltips"></div>
				</div>
				<!--logo start-->
				<a href="#" class="logo">客户<span>E</span></a>
				<!--logo end-->				
				<div class="top-nav ">
					<!--search & user info start-->
					<ul class="nav pull-right top-menu">
						
						<!-- user login dropdown start-->
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<img alt="" src="img/avatar1_small.jpg">
								<span class="username" id="username"></span>
								<b class="caret"></b>
							</a>
							<ul class="dropdown-menu extended logout">
								<div class="log-arrow-up"></div>								
								<li>
									<a href="login.html" class="log-out"><i class="icon-key"></i> 登出</a>
								</li>
							</ul>
						</li>
						<!-- user login dropdown end -->
					</ul>
					<!--search & user info end-->
				</div>
			</header>
      <!--header end-->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu">
                  <li>
                      <a class="" href="home.html">
                          <i class="icon-dashboard"></i>
                          <span>仪表盘</span>
                      </a>
                  </li>
                  <li class="active">
                      <a href="customers.html" class="">
                          <i class="icon-book"></i>
                          <span>客户</span>
                      </a>                     
                  </li>
                  <li>
                      <a href="supplier.html" class="">
                          <i class="icon-book"></i>
                          <span>供应商</span>
                      </a>                     
                  </li>
                  <li>
                      <a href="goods.html" class="">
                          <i class="icon-book"></i>
                          <span>商品</span>
                      </a>                     
                  </li>
                  <li>
                      <a href="records.html" class="">
                          <i class="icon-book"></i>
                          <span>进货/销售/退货记录</span>
                      </a>                     
                  </li>
              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">
              <!-- page start-->              
              <div class="row">
                  <div class="col-lg-12">
                      <section class="panel">
                          <header class="panel-heading">
                          	记录列表                          	
                          	<a class="btn btn-info btn-add" href="addrecords.html"><i class="icon-plus"></i></a>
                          </header>
                          <header class="panel-heading panel-heading-xs">
                          	<a class="btn btn-info-g btn-xs selected" data-v="0">全部</a>
                          	<a class="btn btn-info-g btn-xs" data-v="1">进货</a>
                          	<a class="btn btn-info-g btn-xs" data-v="2">销售</a>
                          	<a class="btn btn-info-g btn-xs" data-v="3">退货</a>
                          </header>
                          <table class="table table-striped table-advance table-hover">
                              <thead>
	                              <tr>
	                              		<th></th>
	                                  <th>客户</th>
	                                  <th>商品</th>
	                                  <th>花费</th>
	                                  <th>详情</th>	                                  
	                              </tr>
                              </thead>
                              <tbody id="records-list">
	                              
                              </tbody>
                          </table>
                          <div class="fenye">
											    	<ul>
											        	<li id="first">首页</li>
											            <li id="top" onclick="topclick()">上一页</li>
											            <li class="xifenye" id="xifenye">
											            	<a id="xiye">1</a>/<a id="mo">1</a>
											                <div class="xab" id="xab" style="display:none">
											                	<ul id="uljia">
											                    	
											                    </ul>
											                </div>
											            </li>
											            <li id="down" onclick="downclick()">下一页</a></li>
											            <li id="last">末页</li>
											        </ul>
											    
											    </div>
                      </section>
                  </div>
              </div>
              <!-- page end-->
          </section>
      </section>
      <!--main content end-->
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="//cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <!--<script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>-->
    <!--<script src="js/jquery.scrollTo.min.js"></script>-->
    <script src="//cdn.bootcss.com/jquery-scrollTo/1.4.6/jquery.scrollTo.min.js"></script>
    <!--<script src="js/jquery.nicescroll.js" type="text/javascript"></script>-->
    <script src="//cdn.bootcss.com/jquery.nicescroll/3.5.1/jquery.nicescroll.min.js"></script>

    <!--common script for all pages-->
    <script src="js/common-scripts.js"></script>
    <!--<script src="js/jquery.cookie.js"></script>-->
    <script src="js/public.js"></script>
    <script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script type="text/javascript">
    	var page=1;//初始第一页
		  var pageSize=10;//初始一页数量
		  var to = 0;
		  var ticket = $.cookie("ticket");  
    	$(function(){
    		loginFlag(ticket);  
    		records(page);   
    		initPage();
				$(".log-out").click(function(){//每次登录时把cookie中ticket清除
					$.cookie("ticket", '', { expires: -1 }); 
				});
				$(".btn-info-g").click(function() {
					$(".btn-info-g").removeClass('selected');
					$(this).addClass('selected');
					records(page);
					initPage();
				});
    	});    	
    	//判断当前用户是否已经登录
    	function loginFlag(ticket){    		
    		if(ticket == '' || ticket == undefined){
    			location.href = 'login.html';
    		}
    		$("#username").html($.cookie("name"));
    	}
    	function gotoPage(p){
					page = p;
					records(page);
			}
    	function initPage(){ 
				var maxPage = to>0?Math.ceil(to/pageSize):1;	
				$("#mo").html(maxPage);					
   		}
    	
    	function records(page){	  
    			var type = $(".selected").attr('data-v');
	        $.ajax({
	            type : "GET",
	            url : 'http://123.57.141.203:8314/records',
	            dataType:'json',
	            async: false,
	            data:{
                "type":type,
                "page":page,
                "pageSize":pageSize
	            },   
	            headers:{
	            	"ticket":ticket
	            },	            
	            success : function(data) {
	            	if(data.code == 200){
	            		to=data.total;
	            		$("#records-list").empty();	
	            		if(data.total == 0){
	            			$("#records-list").append('<tr><td style="text-align: center;" colspan=4>没有找到您需要的数据！</td></tr>');
	            		} else {
	            			var records = data.data;
		            		for(var i=0;i<records.length;i++){
		            			$("#records-list").append('<tr><td>'+typeN(records[i].type)+'</td>'+
		            						'<td>'+records[i].customerName+'</td>'+
	                          '<td>'+records[i].goodName+'<span class="span-i">*</span>'+records[i].number+'</td>'+
	                          '<td>'+costMoney(records[i])+'<span class="span-m">¥</span></td>'+
	                          '<td>'+
	                              '<button data-original-title="详细信息" data-content="'+details(records[i])+'" data-placement="left" data-trigger="hover" class="btn btn-success btn-xs popovers">详情</button>'+
	                          '</td>'+
	                      '</tr>');
		            		}
		            		$(".popovers").click(function(){
						    			$(this).popover({html : true});					    			
											$(this).popover('show');
						    		});
	            		}	            							    		
	            	} else if(data.code == 401){
	            		location.href= "login.html";
	            	}else{
	            		console.log(data);
	            		//location.href= "login.html";
	            	}
	            },
	            // 调用出错执行的函数
	            error : function() {
	                console.log('customers-list error');
	            }
	        });
	    } 
	    function costMoney(record){
	    	if(record.type == 1){
	    		return "-"+(record.productionPrice+record.otherPrice);
	    	} else if(record.type == 2){
	    		return "+"+record.sellPrice;
	    	} else if(record.type == 3){
	    		return "-"+record.damagePrice;
	    	} else {
	    		return "异常";
	    	}
	    }
	    function details(record){
	    	if(record.type==1){
	    		return '产品费用：'+record.productionPrice+'<br>其他费用：'+record.otherPrice+'<br>创建时间：'+record.createTime;
	    	}else if(record.type==2){
	    		return '销售价格：'+record.sellPrice+'<br>利润：'+record.profitPrice+'<br>创建时间：'+record.createTime;
	    	}else if(record.type==3){
	    		return '折损费用：'+record.damagePrice+'<br>创建时间：'+record.createTime;
	    	}else{
	    		return '异常数据';
	    	}
	    }
	    function typeN(type){
	    	if(type == 1){
	    		return '<span class="label label-primary label-icon">进</span>';
	    	} else if(type == 2){
	    		return '<span class="label label-success label-icon">售</span>';
	    	} else if(type == 3){
	    		return '<span class="label label-warning label-icon">退</span>';
	    	} else {
	    		return '<span class="label label-danger label-icon">异</span>';
	    	}
	    }
    </script>


  </body>
</html>
