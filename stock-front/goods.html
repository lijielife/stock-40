<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="img/favicon.html">

    <title>商品</title>

    <!-- Bootstrap core CSS -->
    <!--<link href="css/bootstrap.min.css" rel="stylesheet">-->
    <link href="//cdn.bootcss.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />
    
    <link rel="stylesheet" href="css/jqpagination.css" /><!--分页-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
    	body{
    		font-size: 13px;
    	}
    	.label-mini{
    		padding: 0.25em 0.4em;
    	}    	
    	.btn{
    		margin: 0 4px 0 0;
    	}
    	.btn-add{    		
		    float: right;
		    padding: 3.5px 8px;
    		margin: -3.5px 0 0 0;
    	}
    	.modal-dialog{
    		padding: 0;
    	}
    	.panel-body{/*同上*/
    		padding: 0;
    	}
  		.popover{
  			width: 170px;
  		}   	
    </style>
  </head>

  <body>

  <section id="container" class="">
      <!--header start-->
      <header class="header white-bg">
          <div class="sidebar-toggle-box">
              <div data-original-title="Toggle Navigation" data-placement="right" class="icon-reorder tooltips"></div>
          </div>
          <!--logo start-->
          <a href="#" class="logo" >客户<span>E</span></a>
          <!--logo end-->
          <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
              <!-- settings start -->
              <li class="dropdown">
                  <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                      <i class="icon-tasks"></i>
                      <span class="badge bg-success">6</span>
                  </a>
                  <ul class="dropdown-menu extended tasks-bar">
                      <div class="notify-arrow notify-arrow-green"></div>
                      <li>
                          <p class="green">You have 6 pending tasks</p>
                      </li>
                      <li>
                          <a href="#">
                              <div class="task-info">
                                  <div class="desc">Dashboard v1.3</div>
                                  <div class="percent">40%</div>
                              </div>
                              <div class="progress progress-striped">
                                  <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                      <span class="sr-only">40% Complete (success)</span>
                                  </div>
                              </div>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <div class="task-info">
                                  <div class="desc">Database Update</div>
                                  <div class="percent">60%</div>
                              </div>
                              <div class="progress progress-striped">
                                  <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                      <span class="sr-only">60% Complete (warning)</span>
                                  </div>
                              </div>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <div class="task-info">
                                  <div class="desc">Iphone Development</div>
                                  <div class="percent">87%</div>
                              </div>
                              <div class="progress progress-striped">
                                  <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 87%">
                                      <span class="sr-only">87% Complete</span>
                                  </div>
                              </div>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <div class="task-info">
                                  <div class="desc">Mobile App</div>
                                  <div class="percent">33%</div>
                              </div>
                              <div class="progress progress-striped">
                                  <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 33%">
                                      <span class="sr-only">33% Complete (danger)</span>
                                  </div>
                              </div>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <div class="task-info">
                                  <div class="desc">Dashboard v1.3</div>
                                  <div class="percent">45%</div>
                              </div>
                              <div class="progress progress-striped active">
                                  <div class="progress-bar"  role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 45%">
                                      <span class="sr-only">45% Complete</span>
                                  </div>
                              </div>

                          </a>
                      </li>
                      <li class="external">
                          <a href="#">See All Tasks</a>
                      </li>
                  </ul>
              </li>
              <!-- settings end -->
              <!-- inbox dropdown start-->
              <li id="header_inbox_bar" class="dropdown">
                  <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                      <i class="icon-envelope-alt"></i>
                      <span class="badge bg-important">5</span>
                  </a>
                  <ul class="dropdown-menu extended inbox">
                      <div class="notify-arrow notify-arrow-red"></div>
                      <li>
                          <p class="red">You have 5 new messages</p>
                      </li>
                      <li>
                          <a href="#">
                              <span class="photo"><img alt="avatar" src="img/avatar-mini.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Jonathan Smith</span>
                                    <span class="time">Just now</span>
                                    </span>
                                    <span class="message">
                                        Hello, this is an example msg.
                                    </span>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span class="photo"><img alt="avatar" src="img/avatar-mini2.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Jhon Doe</span>
                                    <span class="time">10 mins</span>
                                    </span>
                                    <span class="message">
                                     Hi, Jhon Doe Bhai how are you ?
                                    </span>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span class="photo"><img alt="avatar" src="img/avatar-mini3.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Jason Stathum</span>
                                    <span class="time">3 hrs</span>
                                    </span>
                                    <span class="message">
                                        This is awesome dashboard.
                                    </span>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span class="photo"><img alt="avatar" src="img/avatar-mini4.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Jondi Rose</span>
                                    <span class="time">Just now</span>
                                    </span>
                                    <span class="message">
                                        Hello, this is metrolab
                                    </span>
                          </a>
                      </li>
                      <li>
                          <a href="#">See all messages</a>
                      </li>
                  </ul>
              </li>
              <!-- inbox dropdown end -->
              <!-- notification dropdown start-->
              <li id="header_notification_bar" class="dropdown">
                  <a data-toggle="dropdown" class="dropdown-toggle" href="#">

                      <i class="icon-bell-alt"></i>
                      <span class="badge bg-warning">7</span>
                  </a>
                  <ul class="dropdown-menu extended notification">
                      <div class="notify-arrow notify-arrow-yellow"></div>
                      <li>
                          <p class="yellow">You have 7 new notifications</p>
                      </li>
                      <li>
                          <a href="#">
                              <span class="label label-danger"><i class="icon-bolt"></i></span>
                              Server #3 overloaded.
                              <span class="small italic">34 mins</span>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span class="label label-warning"><i class="icon-bell"></i></span>
                              Server #10 not respoding.
                              <span class="small italic">1 Hours</span>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span class="label label-danger"><i class="icon-bolt"></i></span>
                              Database overloaded 24%.
                              <span class="small italic">4 hrs</span>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span class="label label-success"><i class="icon-plus"></i></span>
                              New user registered.
                              <span class="small italic">Just now</span>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span class="label label-info"><i class="icon-bullhorn"></i></span>
                              Application error.
                              <span class="small italic">10 mins</span>
                          </a>
                      </li>
                      <li>
                          <a href="#">See all notifications</a>
                      </li>
                  </ul>
              </li>
              <!-- notification dropdown end -->
          </ul>
          </div>
          <div class="top-nav ">
              <ul class="nav pull-right top-menu">
                  <li>
                      <input type="text" class="form-control search" placeholder="Search">
                  </li>
                  <!-- user login dropdown start-->
                  <li class="dropdown">
                      <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                          <img alt="" src="img/avatar1_small.jpg">
                          <span class="username" id="username"></span>
                          <b class="caret"></b>
                      </a>
                      <ul class="dropdown-menu extended logout">
                          <div class="log-arrow-up"></div>
                          <li><a href="#"><i class=" icon-suitcase"></i>Profile</a></li>
                          <li><a href="#"><i class="icon-cog"></i> Settings</a></li>
                          <li><a href="#"><i class="icon-bell-alt"></i> Notification</a></li>
                          <li><a href="login.html" class="log-out"><i class="icon-key"></i>登出</a></li>
                      </ul>
                  </li>
                  <!-- user login dropdown end -->
              </ul>
          </div>
      </header>
      <!--header end-->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu">
                  <li>
                      <a class="" href="home.html">
                          <i class="icon-dashboard"></i>
                          <span>仪表盘</span>
                      </a>
                  </li>
                  <li>
                      <a href="customers.html" class="">
                          <i class="icon-book"></i>
                          <span>客户</span>
                      </a>                     
                  </li>
                  <li>
                      <a href="supplier.html" class="">
                          <i class="icon-book"></i>
                          <span>供应商</span>
                      </a>                     
                  </li>
                  <li class="active">
                      <a href="goods.html" class="">
                          <i class="icon-book"></i>
                          <span>商品</span>
                      </a>                     
                  </li> 
                  <li>
                    <a href="records.html" class="">
                        <i class="icon-book"></i>
                        <span>进货/销售/退货记录</span>
                    </a>                     
                  </li>
                  <li>
                      <a class="log-out" href="login.html">
                          <i class="icon-user"></i>
                          <span>登录页</span>
                      </a>
                  </li>
              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">
              <!-- page start-->              
              <div class="row">
                  <div class="col-lg-12">
                      <section class="panel">
                          <header class="panel-heading">商品列表<a class="btn btn-info btn-add" id="addModal"><i class="icon-plus"></i></a></header>
                          
                          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                              <div class="modal-dialog">
                                  <div class="modal-content">
                                      <div class="modal-header">
                                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>
                                          <h4 class="modal-title">新增-商品</h4>
                                      </div>
                                      <div class="modal-body">
                                      	<section class="panel">
									                          <!--<header class="panel-heading">
									                              Basic validations
									                          </header>-->
									                          <div class="panel-body" id="myModal-body">
									                              <form class="form-horizontal tasi-form">
									                                  <div class="form-group">
									                                      <label class="col-lg-2 control-label">商品名称</label>
									                                      <div class="col-lg-10">
									                                          <input type="text" placeholder="" id="name" class="form-control">
									                                      </div>
									                                  </div>
									                                  <div class="form-group">
									                                      <label class="col-lg-2 control-label">单价</label>
									                                      <div class="col-lg-10">
									                                          <input type="text" placeholder="" id="unitPrice" class="form-control">
									                                      </div>
									                                  </div>									
									                                  <div class="form-group">
									                                      <div class="col-lg-offset-2 col-lg-10">
									                                          <button class="btn btn-danger" type="button" id="add-goods">提交</button>
									                                          <button data-dismiss="modal" class="btn btn-default" type="button">取消</button>
									                                      </div>
									                                  </div>
									                              </form>
									                          </div>
									                      </section>
                                      </div>
                                      <!--<div class="modal-footer">
                                          <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                                          <button class="btn btn-success" type="button">Save changes</button>
                                      </div>-->
                                  </div>
                              </div>
                          </div>
                          <table class="table table-striped table-advance table-hover">
                              <thead>
	                              <tr>
	                                  <th>名称</th>
	                                  <th>库存</th>
	                                  <th>单价</th>
	                                  <th>操作</th>
	                              </tr>
                              </thead>
                              <tbody id="goods-list">
	                              
                              </tbody>                              
                          </table>
                          <div class="gigantic pagination">
                          		
												    <div class="btn-left">												    	
												    	<a href="#" class="first" data-action="first">&laquo;</a>
												    	<!--<a href="#" class="previous" data-action="previous">&lsaquo;</a>-->
												    </div>
												    <div class="btn-input">												    
												    	<input type="text" readonly="readonly" data-max-page="40" />
												    </div>
												    <div class="btn-right">												    
													    <!--<a href="#" class="next" data-action="next">&rsaquo;</a>-->
													    <a href="#" class="last" data-action="last">&raquo;</a>
												   	</div>
													</div>
                          <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                              <div class="modal-dialog">
                                  <div class="modal-content" id="updateModal-content">
	                                  <div class="modal-header">
	                                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>
	                                      <h4 class="modal-title">修改-供应商</h4>
	                                  </div>
	                                  <div class="modal-body">
	                                  	<section class="panel">
									                          <!--<header class="panel-heading">
									                              Basic validations
									                          </header>-->
									                          <div class="panel-body" id="myModal-body">
									                              <div class="form-horizontal tasi-form">
									                                  <div class="form-group">
									                                      <label class="col-lg-2 control-label">名称</label>
									                                      <div class="col-lg-10">
									                                          <input type="text" placeholder="" id="_name" class="form-control">
									                                      </div>
									                                  </div>
									                                  <div class="form-group">
									                                      <label class="col-lg-2 control-label">单价</label>
									                                      <div class="col-lg-10">
									                                          <input type="text" placeholder="" id="_unitPrice" class="form-control">
									                                      </div>
									                                  </div>									                                  
									                                  <div class="form-group">
									                                      <div class="col-lg-offset-2 col-lg-10">
									                                          <button class="btn btn-danger" type="button" id="update-goods" data-id="">提交</button>
									                                          <button data-dismiss="modal" class="btn btn-default" type="button">取消</button>
									                                      </div>
									                                  </div>
									                              </div>
									                          </div>
									                      </section>
	                                  </div>
                                  </div>
                              </div>
                          </div>
                      </section>
                  </div>
              </div>
              <!-- page end-->
          </section>
      </section>
      <!--main content end-->
  </section>
 
<!--<div class="alert alert-success fade">
      <button data-dismiss="alert" class="close close-sm" type="button">
          <i class="icon-remove"></i>
      </button>
      <strong>Well done!</strong> You successfully read this important alert message.
  </div>-->

    <!-- js placed at the end of the document so the pages load faster -->
    <!--<script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>-->
    <script src="//cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <!--<script src="js/jquery.scrollTo.min.js"></script>-->
    <script src="//cdn.bootcss.com/jquery-scrollTo/1.4.6/jquery.scrollTo.min.js"></script>
    <!--<script src="js/jquery.nicescroll.js" type="text/javascript"></script>-->
    <script src="//cdn.bootcss.com/jquery.nicescroll/3.5.1/jquery.nicescroll.min.js"></script>

    <!--common script for all pages-->
    <script src="js/common-scripts.js"></script>
    <!--<script src="js/jquery.cookie.js"></script>-->
    <script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <!--分页-->
    <script type="text/javascript" src="js/jquery.jqpagination.js" ></script>
    <script type="text/javascript">
    	$(function(){
    		var page=1;//初始第一页
    		var pageSize=2;//初始一页数量
    		var to = 0;
    		var ticket = $.cookie("ticket");    		
    		loginFlag(ticket);    		
    		goods(page);
    		$("#add-goods").click(function(){
    			addGoods();
    		});    		
    		$('#addModal').click(function(){    			
    			$("#myModal").modal('show');
    		});
    		$('#update-goods').click(function(){
    			var id = $(this).attr('data-id');
    			updateGoods(id);
    		});
    		/*window.setTimeout(function(){
				    $('[data-dismiss="alert"]').alert('close');
				},2000);*/
				$(".log-out").click(function(){//每次登录时把cookie中ticket清除
					$.cookie("ticket", '', { expires: -1 }); 
				});
				initPage(page,to);
				function initPage(page,total){ 
					console.log("total:"+total);
					var maxPage = total>0?Math.ceil(total/pageSize):1;
					console.log("maxPage"+maxPage+"page:"+page);					
					console.log("page:"+page);
	    		$('.pagination').jqPagination({
						current_page	: page,
						link_string		: '',
						max_page		: maxPage,
						page_string		: '当前 {current_page} / {max_page}',
					    paged: function(p) {	
					    	page = p;
					      goods(p);  
					    }
					});
	    	}
				function goods(page){	  
					console.log(page);
	        $.ajax({
	            type : "GET",
	            url : 'http://123.57.141.203:8314/goods',
	            dataType:'json',
	            async: false,
	            data:{
                "page":page,
                "pageSize":pageSize
	            },   
	            headers:{
	            	"ticket":ticket
	            },	            
	            success : function(data) {
	            	console.log(data);
	            	if(data.code == 200){
	            		to=data.total;
	            		$("#goods-list").empty();	            		
	            		var goods = data.data;
	            		for(var i=0;i<goods.length;i++){
	            			$("#goods-list").append('<tr><td>'+goods[i].name+'</td>'+
                          '<td>'+goods[i].number+'</td>'+
                          '<td>'+goods[i].unitPrice+'</td>'+
                          '<td>'+
                              '<button data-original-title="详细信息" data-content="进货批次：'+goods[i].recordId+'<br>批次余量：'+goods[i].stockNumber+'<br>总进货额：'+goods[i].productionPrice+' ¥<br>总销售额：'+goods[i].sellPrice+' ¥<br>总销售量：'+goods[i].sellNumber+'<br>总利润：'+goods[i].profitPrice+' ¥<br>总折损：'+goods[i].damagePrice+' ¥" data-placement="left" data-trigger="hover" class="btn btn-success btn-xs popovers">详情</button>'+
                              '<button class="btn btn-primary btn-xs" data-reactid="updateGoods" data-id="'+goods[i].id+'"><i class="icon-pencil"></i></button>'+
                              '<button class="btn btn-danger btn-xs" data-reactid="delectGoods" data-id="'+goods[i].id+'"><i class="icon-trash "></i></button>'+
                          '</td>'+
                      '</tr>');
	            		}
	            		$(".popovers").click(function(){
					    			$(this).popover({html : true});					    			
										$(this).popover('show');
					    		});
					    		$("button[data-reactid='updateGoods']").click(function(){
					    			var id = $(this).attr('data-id');
					    			updateModal(id);
					    		});
					    		$("button[data-reactid='delectGoods']").click(function(){
					    			var id = $(this).attr('data-id');
					    			delectGoods(id);
					    		});
					    		//initPage(page,to);
					    		/*if(T){
					    			initPage(data.total);
					    			T=false;
					    		}*/
					    		
					    		console.log("data.page:"+data.page);
	            	} else {
	            		location.href= "login.html";
	            	}
	            },
	            // 调用出错执行的函数
	            error : function() {
	                console.log('goods-list error');
	            }
	        });
		    }    	
	    	function addGoods(){
	    		var name =$("#name").val().replace(/\s/g,"");
	        var unitPrice =$("#unitPrice").val().replace(/\s/g,"");
	    		$.ajax({
	            type : "POST",
	            url : 'http://123.57.141.203:8314/goods',
	            contentType: "application/json; charset=utf-8",
	            dataType:'json',
	            data:JSON.stringify({
						    "name":name,
						    "unitPrice":unitPrice
	            }),   
	            headers:{
	            	"ticket":ticket
	            },	            
	            success : function(data) {
	            	if(data.code == 200){
	            		$("#myModal").modal('hide');  
	            		goods(page);
	            		initPage(page,to);
	            	} else {
	            		console.log(data);
	            	}
	            },
	            // 调用出错执行的函数
	            error : function() {
	                console.log('goods-add error');
	            }
	        });
	    	}
	    	function updateGoods(id){
	    		console.log(id);
	    		var name =$("#_name").val().replace(/\s/g,"");
	        var unitPrice =$("#_unitPrice").val().replace(/\s/g,"");
	    		$.ajax({
	            type : "PUT",
	            url : 'http://123.57.141.203:8314/goods',
	            contentType: "application/json; charset=utf-8",
	            dataType:'json',
	            data:JSON.stringify({
	            	"id":id,
						    "name":name,
						    "unitPrice":unitPrice
	            }),   
	            headers:{
	            	"ticket":ticket
	            },	            
	            success : function(data) {
	            	if(data.code == 200){
	            		$("#updateModal").modal('hide');  
	            		goods(page);
	            	} else {
	            		console.log(data);
	            	}
	            },
	            // 调用出错执行的函数
	            error : function() {
	                console.log('goods-update error');
	            }
	        });
	    	}
	    	function delectGoods(id){
	    		$.ajax({
	            type : "DELETE",
	            url : 'http://123.57.141.203:8314/goods?id='+id,
	            dataType:'json',
	            headers:{
	            	"ticket":ticket
	            },	            
	            success : function(data) {
	            	console.log(data);
	            	if(data.code == 200){
	            		var maxPage = to>0?Math.ceil((to-1)/pageSize):1;
	            		page = page>maxPage?maxPage:page;
	   
	            		goods(page);
	            		initPage(page,to);
	            	} else {
	            		console.log(data);
	            	}
	            },
	            // 调用出错执行的函数
	            error : function() {
	                console.log('goods-delect error');
	            }
	        });
	    	}
	    	function updateModal(id){
	    		$.ajax({
	            type : "GET",
	            url : 'http://123.57.141.203:8314/goods?id='+id,
	            dataType:'json',
	            headers:{
	            	"ticket":ticket
	            },	            
	            success : function(data) {
	            	console.log(data);
	            	if(data.code == 200){
	            		var goods = data.data
	            		$("#_name").val(goods[0].name);
	            		$("#_unitPrice").val(goods[0].unitPrice);            		
	            		$("#update-goods").attr('data-id',goods[0].id);
	            		$("#updateModal").modal('show');
	            	} else {
	            		console.log(data);
	            	}
	            },
	            // 调用出错执行的函数
	            error : function() {
	                console.log('customers-modal error');
	            }
	        });
	    	}
    	});
    	//判断当前用户是否已经登录
    	function loginFlag(ticket){    		
    		if(ticket == '' || ticket == undefined){
    			location.href = 'login.html';
    		}
    		$("#username").html($.cookie("name"));
    	}
    	
    </script>


  </body>
</html>
