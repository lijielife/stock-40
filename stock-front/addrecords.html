<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="Mosaddek">
		<meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
		<link rel="shortcut icon" href="img/favicon.html">

		<title>新增记录</title>

		<!-- Bootstrap core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">
		<!--external css-->
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
		<!-- Custom styles for this template -->
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet" />

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
		<!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
		<style type="text/css">
			.label-mini {
				padding: 0.25em 0.4em;
			}
			
			.btn {
				margin: 0 4px 0 0;
			}
			
			.btn-add {
				float: right;
				padding: 3.5px 8px;
				margin: -3.5px 0 0 0;
			}
			
			.modal-dialog {
				padding: 0;
			}
			
			.panel-body {
				/*同上*/
				padding: 0;
			}
			
			.popover {
				width: 170px;
			}
			
			.btn-info-g {
				background-color: #fff;
				color: #58c9f3;
				border-color: #58c9f3;
			}
			
			.selected {
				background-color: #58c9f3;
				color: #fff;
			}
			
			.selected:hover,
			.selected:focus {
				color: #fff;
			}
			
			.panel-heading-xs {
				padding: 5px 15px;
			}
			
			.select-cz {
				position: relative;
				display: block;
			}
			
			.select-cz select {
				position: absolute;
				z-index: 1;
			}
			h4 small{
			  font-size: 12px;
		    display: block;
		    padding-top: 5px;
		    color: #f1cb24;
			}
			.breadcrumb{
				margin-bottom: 5px;
			}
		</style>
	</head>

	<body>

		<section id="container" class="">
			<!--header start-->
			<header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-original-title="Toggle Navigation" data-placement="right" class="icon-reorder tooltips"></div>
				</div>
				<!--logo start-->
				<a href="#" class="logo">客户<span>E</span></a>
				<!--logo end-->
				<div class="nav notify-row" id="top_menu">
					<!--  notification start -->
					<ul class="nav top-menu">
						<!-- settings start -->
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<i class="icon-tasks"></i>
								<span class="badge bg-success">6</span>
							</a>
							<ul class="dropdown-menu extended tasks-bar">
								<div class="notify-arrow notify-arrow-green"></div>
								<li>
									<p class="green">You have 6 pending tasks</p>
								</li>
								<li>
									<a href="#">
										<div class="task-info">
											<div class="desc">Dashboard v1.3</div>
											<div class="percent">40%</div>
										</div>
										<div class="progress progress-striped">
											<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
												<span class="sr-only">40% Complete (success)</span>
											</div>
										</div>
									</a>
								</li>
								<li>
									<a href="#">
										<div class="task-info">
											<div class="desc">Database Update</div>
											<div class="percent">60%</div>
										</div>
										<div class="progress progress-striped">
											<div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
												<span class="sr-only">60% Complete (warning)</span>
											</div>
										</div>
									</a>
								</li>
								<li>
									<a href="#">
										<div class="task-info">
											<div class="desc">Iphone Development</div>
											<div class="percent">87%</div>
										</div>
										<div class="progress progress-striped">
											<div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 87%">
												<span class="sr-only">87% Complete</span>
											</div>
										</div>
									</a>
								</li>
								<li>
									<a href="#">
										<div class="task-info">
											<div class="desc">Mobile App</div>
											<div class="percent">33%</div>
										</div>
										<div class="progress progress-striped">
											<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 33%">
												<span class="sr-only">33% Complete (danger)</span>
											</div>
										</div>
									</a>
								</li>
								<li>
									<a href="#">
										<div class="task-info">
											<div class="desc">Dashboard v1.3</div>
											<div class="percent">45%</div>
										</div>
										<div class="progress progress-striped active">
											<div class="progress-bar" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 45%">
												<span class="sr-only">45% Complete</span>
											</div>
										</div>

									</a>
								</li>
								<li class="external">
									<a href="#">See All Tasks</a>
								</li>
							</ul>
						</li>
						<!-- settings end -->
						<!-- inbox dropdown start-->
						<li id="header_inbox_bar" class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<i class="icon-envelope-alt"></i>
								<span class="badge bg-important">5</span>
							</a>
							<ul class="dropdown-menu extended inbox">
								<div class="notify-arrow notify-arrow-red"></div>
								<li>
									<p class="red">You have 5 new messages</p>
								</li>
								<li>
									<a href="#">
										<span class="photo"><img alt="avatar" src="img/avatar-mini.jpg"></span>
										<span class="subject">
                                    <span class="from">Jonathan Smith</span>
										<span class="time">Just now</span>
										</span>
										<span class="message">
                                        Hello, this is an example msg.
                                    </span>
									</a>
								</li>
								<li>
									<a href="#">
										<span class="photo"><img alt="avatar" src="img/avatar-mini2.jpg"></span>
										<span class="subject">
                                    <span class="from">Jhon Doe</span>
										<span class="time">10 mins</span>
										</span>
										<span class="message">
                                     Hi, Jhon Doe Bhai how are you ?
                                    </span>
									</a>
								</li>
								<li>
									<a href="#">
										<span class="photo"><img alt="avatar" src="img/avatar-mini3.jpg"></span>
										<span class="subject">
                                    <span class="from">Jason Stathum</span>
										<span class="time">3 hrs</span>
										</span>
										<span class="message">
                                        This is awesome dashboard.
                                    </span>
									</a>
								</li>
								<li>
									<a href="#">
										<span class="photo"><img alt="avatar" src="img/avatar-mini4.jpg"></span>
										<span class="subject">
                                    <span class="from">Jondi Rose</span>
										<span class="time">Just now</span>
										</span>
										<span class="message">
                                        Hello, this is metrolab
                                    </span>
									</a>
								</li>
								<li>
									<a href="#">See all messages</a>
								</li>
							</ul>
						</li>
						<!-- inbox dropdown end -->
						<!-- notification dropdown start-->
						<li id="header_notification_bar" class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">

								<i class="icon-bell-alt"></i>
								<span class="badge bg-warning">7</span>
							</a>
							<ul class="dropdown-menu extended notification">
								<div class="notify-arrow notify-arrow-yellow"></div>
								<li>
									<p class="yellow">You have 7 new notifications</p>
								</li>
								<li>
									<a href="#">
										<span class="label label-danger"><i class="icon-bolt"></i></span> Server #3 overloaded.
										<span class="small italic">34 mins</span>
									</a>
								</li>
								<li>
									<a href="#">
										<span class="label label-warning"><i class="icon-bell"></i></span> Server #10 not respoding.
										<span class="small italic">1 Hours</span>
									</a>
								</li>
								<li>
									<a href="#">
										<span class="label label-danger"><i class="icon-bolt"></i></span> Database overloaded 24%.
										<span class="small italic">4 hrs</span>
									</a>
								</li>
								<li>
									<a href="#">
										<span class="label label-success"><i class="icon-plus"></i></span> New user registered.
										<span class="small italic">Just now</span>
									</a>
								</li>
								<li>
									<a href="#">
										<span class="label label-info"><i class="icon-bullhorn"></i></span> Application error.
										<span class="small italic">10 mins</span>
									</a>
								</li>
								<li>
									<a href="#">See all notifications</a>
								</li>
							</ul>
						</li>
						<!-- notification dropdown end -->
					</ul>
				</div>
				<div class="top-nav ">
					<ul class="nav pull-right top-menu">
						<li>
							<input type="text" class="form-control search" placeholder="Search">
						</li>
						<!-- user login dropdown start-->
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<img alt="" src="img/avatar1_small.jpg">
								<span class="username" id="username"></span>
								<b class="caret"></b>
							</a>
							<ul class="dropdown-menu extended logout">
								<div class="log-arrow-up"></div>
								<li>
									<a href="#"><i class=" icon-suitcase"></i>Profile</a>
								</li>
								<li>
									<a href="#"><i class="icon-cog"></i> Settings</a>
								</li>
								<li>
									<a href="#"><i class="icon-bell-alt"></i> Notification</a>
								</li>
								<li>
									<a href="login.html" class="log-out"><i class="icon-key"></i>登出</a>
								</li>
							</ul>
						</li>
						<!-- user login dropdown end -->
					</ul>
				</div>
			</header>
			<!--header end-->
			<!--sidebar start-->
			<aside>
				<div id="sidebar" class="nav-collapse ">
					<!-- sidebar menu start-->
					<ul class="sidebar-menu">
						<li>
							<a class="" href="home.html">
								<i class="icon-dashboard"></i>
								<span>仪表盘</span>
							</a>
						</li>
						<li class="active">
							<a href="customers.html" class="">
								<i class="icon-book"></i>
								<span>客户</span>
							</a>
						</li>
						<li>
							<a href="supplier.html" class="">
								<i class="icon-book"></i>
								<span>供应商</span>
							</a>
						</li>
						<li>
							<a href="goods.html" class="">
								<i class="icon-book"></i>
								<span>商品</span>
							</a>
						</li>

						<li>
							<a class="log-out" href="login.html">
								<i class="icon-user"></i>
								<span>登录页</span>
							</a>
						</li>
					</ul>
					<!-- sidebar menu end-->
				</div>
			</aside>
			<!--sidebar end-->
			<!--main content start-->
			<section id="main-content">
				<section class="wrapper">
					<div class="row">
              <div class="col-lg-12">
                  <!--breadcrumbs start -->
                  <ul class="breadcrumb">
                      <li><a href="records.html"><i class="icon-home"></i> 记录列表</a></li>
                      <li class="active">新增记录</li>
                  </ul>
                  <!--breadcrumbs end -->
              </div>
          </div>
					<!-- page start-->
					<div class="row">
						<div class="col-lg-12">
							<section class="panel">
								<header class="panel-heading">新增记录</header>
								<header class="panel-heading panel-heading-xs">
									<a class="btn btn-info-g btn-xs selected" data-v="1">进货记录</a>
									<a class="btn btn-info-g btn-xs" data-v="2">销售记录</a>
									<a class="btn btn-info-g btn-xs" data-v="3">退货记录</a>
								</header>

								<div class="form-horizontal tasi-form panel-heading">
									<div id="ma-control">
										<!--添加进货信息-->
										<div class="form-group">
											<label class="col-lg-2 control-label">供应商</label>
											<div class="col-lg-10">
												<button type="button" id="supplier" data-id="" onclick="modal(1)" class="btn btn-block">选供应商</button>
											</div>
										</div>
										<div class="form-group">
											<label class="col-lg-2 control-label">商品</label>
											<div class="col-lg-10">
												<button type="button" id="goods" data-id="" onclick="modal(3)" class="btn btn-block">选商品</button>
											</div>
										</div>
										<div class="form-group">
											<label class="col-lg-2 control-label">数量</label>
											<div class="col-lg-10">
												<input type="text" placeholder="" id="number" class="form-control">
											</div>
										</div>
										<div class="form-group">
											<label class="col-lg-2 control-label">产品费用</label>
											<div class="col-lg-10">
												<input type="text" placeholder="" id="productionPrice" class="form-control">
											</div>
										</div>
										<div class="form-group">
											<label class="col-lg-2 control-label">其他费用</label>
											<div class="col-lg-10">
												<input type="text" placeholder="" id="otherPrice" class="form-control">
											</div>
										</div>

									</div>

									<div class="form-group">
										<div class="col-lg-offset-2 col-lg-10">
											<button class="btn btn-danger" type="button" id="add-m">提交</button>
											<!--<button data-dismiss="modal" class="btn btn-default" type="button">取消</button>-->
										</div>
									</div>

								</div>
							</section>
							<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>
											<h4 class="modal-title">供应商-列表<small>只显示200名，如果不能满足可以通过姓名查找。</small></h4>
										</div>
										<div class="modal-body">
											<section class="panel">												
												<div class="panel-body" id="myModal-body">
													<div class="form-horizontal tasi-form">														
														<input class="form-control input-lg m-bot15" id="find-i" type="text" oninput="OnInput(event)" onpropertychange="OnPropChanged(event)" placeholder="按姓名查找">
														<div id="ma-control">
															<table class="table table-striped table-advance table-hover">		                             
		                              <tbody id="m-list">
		                              </tbody>
		                          </table>  

														</div>
													</div>
												</div>
											</section>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- page end-->
				</section>
			</section>
			<!--main content end-->
		</section>

		<!-- js placed at the end of the document so the pages load faster -->
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.scrollTo.min.js"></script>
		<script src="js/jquery.nicescroll.js" type="text/javascript"></script>

		<!--common script for all pages-->
		<script src="js/common-scripts.js"></script>
		<script src="js/jquery.cookie.js"></script>
		<script type="text/javascript">
			var ticket = $.cookie("ticket");
			$(function() {				
				loginFlag();
				
				$(".log-out").click(function() { //每次登录时把cookie中ticket清除
					$.cookie("ticket", '', {expires: -1});
				});
				$(".btn-info-g").click(function() {
					$(".btn-info-g").removeClass('selected');
					$(this).addClass('selected');
					initAddModal();
				});
				$('#myModal').on('hide.bs.modal', function () {
				  $("#find-i").val('');
				})
				$("#add-m").click(function(){
					var type = $(".selected").attr("data-v");
					addM(type);
				});
				
			});

			//判断当前用户是否已经登录
			function loginFlag() {
				if(ticket == '' || ticket == undefined) {
					location.href = 'login.html';
				}
				$("#username").html($.cookie("name"));
			}

			function initAddModal() {
				var type = $(".selected").attr("data-v");
				if(type == 1) {
					//添加进货模板
					stock();
				} else if(type == 2) {
					//添加售货模板
					sell();
				} else {
					//添加退货模板
					back();
				}
			}

			function kehu(type,name) {				
				$.ajax({
					type: "GET",
					url: 'http://123.57.141.203:8314/customers',
					dataType: 'json',
					data: {
						"type": type,
						"name":name,
						"page": 1,
						"pageSize": 200
					},
					headers: {
						"ticket": ticket
					},
					success: function(data) {
						console.log(data);
						if(data.code == 200) {
							if(type == 1){
								$(".modal-title").html('供应商-列表<small>只显示200名，如果不能满足可以通过姓名查找。</small>');
							} else {
								$(".modal-title").html('销售客户-列表<small>只显示200名，如果不能满足可以通过姓名查找。</small>');
							}
							$("#find-i").attr('placeholder','按姓名查找');
							
							$("#m-list").empty();
							if(data.total != 0){
								var m = data.data;
								for(var i = 0; i < m.length; i++) {
									$("#m-list").append('<tr>'+
		              		'<td>'+m[i].name+'</td>'+
		                      '<td>t:'+m[i].mobile+'</td>'+
		                      '<td><button class="btn btn-success" data-v="'+m[i].name+' t:'+m[i].mobile+'" data-id='+m[i].id+'>选</button></td>'+
		              	'</tr>');
								}								
								$(".btn-success").click(function() {
									$('#supplier').attr('data-id',$(this).attr('data-id'));
									$('#supplier').html($(this).attr('data-v'));
									$("#myModal").modal("hide");
								});
							} else {
								$("#m-list").append('没有找到您需要的数据！');
							}
							$("#myModal").modal("show");
						} else if(data.code == 401) {
							location.href = "login.html";
						} else {
							console.log(data);
							//location.href= "login.html";
						}
					},
					// 调用出错执行的函数
					error: function() {
						console.log('customers-list error');
					}
				});
			}
			
			function goods(name) {				
				$.ajax({
					type: "GET",
					url: 'http://123.57.141.203:8314/goods',
					dataType: 'json',
					data: {
						"name":name,
						"page": 1,
						"pageSize": 200
					},
					headers: {
						"ticket": ticket
					},
					success: function(data) {
						console.log(data);
						if(data.code == 200) {
							$(".modal-title").html('商品-列表<small>只显示200名，如果不能满足可以通过名称查找。</small>');
							$("#find-i").attr('placeholder','按名称查找');
							
							$("#m-list").empty();
							if(data.total != 0){
								var m = data.data;
								for(var i = 0; i < m.length; i++) {
									$("#m-list").append('<tr>'+
		              		'<td>'+m[i].name+'</td>'+
		                      '<td>库存:'+m[i].number+'</td>'+
		                      '<td><button class="btn btn-success" data-v="'+m[i].name+' 库存:'+m[i].number+'" data-id='+m[i].id+'>选</button></td>'+
		              	'</tr>');
								}								
								$(".btn-success").click(function() {
									$('#goods').attr('data-id',$(this).attr('data-id'));
									$('#goods').html($(this).attr('data-v'));
									$("#myModal").modal("hide");
								});
							} else {
								$("#m-list").append('没有找到您需要的数据！');
							}
							$("#myModal").modal("show");
						} else if(data.code == 401) {
							location.href = "login.html";
						} else {
							console.log(data);
							//location.href= "login.html";
						}
					},
					// 调用出错执行的函数
					error: function() {
						console.log('customers-list error');
					}
				});
			}

			function addM(type) {	
				var customerId = $("#supplier").attr('data-id');
				var goodId = $("#goods").attr('data-id');
				var number = $("#number").val().replace(/\s/g, "");	
				var data;
				if(type==1){
					var productionPrice = $("#productionPrice").val().replace(/\s/g, "");
					var otherPrice = $("#otherPrice").val().replace(/\s/g, "");
					data = {"type":1,"customerId":customerId,"goodId":goodId,"number":number,"productionPrice":productionPrice,"otherPrice":otherPrice};
				} else if(type==2){
					var sellProce = $("#sellProce").val().replace(/\s/g, "");
					data = {"type":2,"customerId":customerId,"goodId":goodId,"number":number,"sellProce":sellProce};
				} else{
					var damagePrice = $("#damagePrice").val().replace(/\s/g, "");
					data = {"type":3,"customerId":customerId,"goodId":goodId,"number":number,"damagePrice":damagePrice};
				}				
				$.ajax({
					type: "POST",
					url: 'http://123.57.141.203:8314/records ',
					contentType: "application/json; charset=utf-8",
					dataType: 'json',
					data: JSON.stringify(data),
					headers: {
						"ticket": ticket
					},
					success: function(data) {
						if(data.code == 200) {							
							console.log(data);
						} else {
							console.log(data);
						}
					},
					// 调用出错执行的函数
					error: function() {
						console.log('新增记录 error');
					}
				});
			}

			function modal(type) {
				$("#find-i").attr("data-type",type);
				//type:1 供应商 2 销售客户 3商品				
				if(type==3){
					goods();
				}else{
					kehu(type);
				}
			}

			function stock() {
				$('#ma-control').empty();
				$('#ma-control').append('<div class="form-group">' +
					'<label class="col-lg-2 control-label">供应商</label>' +
					'<div class="col-lg-10">' +
					'<button type="button" id="supplier" data-id="" onclick="modal(1)" class="btn btn-block">选供应商</button>' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">商品</label>' +
					'<div class="col-lg-10">' +
					'<button type="button" id="goods" data-id="" onclick="modal(3)" class="btn btn-block">选商品</button>' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">数量</label>' +
					'<div class="col-lg-10">' +
					'<input type="text" placeholder="" id="number" class="form-control">' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">产品费用</label>' +
					'<div class="col-lg-10">' +
					'<input type="text" placeholder="" id="productionPrice" class="form-control">' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">其他费用</label>' +
					'<div class="col-lg-10">' +
					'<input type="text" placeholder="" id="otherPrice" class="form-control">' +
					'</div>' +
					'</div>');
			}

			function sell() {
				$('#ma-control').empty();
				$('#ma-control').append('<div class="form-group">' +
					'<label class="col-lg-2 control-label">供应商</label>' +
					'<div class="col-lg-10">' +
					'<button type="button" id="supplier" data-id="" onclick="modal(2)" class="btn btn-block">选销售客户</button>' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">商品</label>' +
					'<div class="col-lg-10">' +
					'<button type="button" id="goods" data-id="" onclick="modal(3)" class="btn btn-block">选商品</button>' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">数量</label>' +
					'<div class="col-lg-10">' +
					'<input type="text" placeholder="" id="number" class="form-control">' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">销售价格</label>' +
					'<div class="col-lg-10">' +
					'<input type="text" placeholder="" id="sellProce" class="form-control">' +
					'</div>' +
					'</div>');
			}

			function back() {
				$('#ma-control').empty();
				$('#ma-control').append('<div class="form-group">' +
					'<label class="col-lg-2 control-label">供应商</label>' +
					'<div class="col-lg-10">' +
					'<button type="button" id="supplier" data-id="" onclick="modal(2)" class="btn btn-block">选销售客户</button>' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">商品</label>' +
					'<div class="col-lg-10">' +
					'<button type="button" id="goods" data-id="" onclick="modal(3)" class="btn btn-block">选商品</button>' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">数量</label>' +
					'<div class="col-lg-10">' +
					'<input type="text" placeholder="" id="number" class="form-control">' +
					'</div>' +
					'</div>' +
					'<div class="form-group">' +
					'<label class="col-lg-2 control-label">折损费用</label>' +
					'<div class="col-lg-10">' +
					'<input type="text" placeholder="" id="damagePrice" class="form-control">' +
					'</div>' +
					'</div>');
			}
			function OnInput (event) {
				var type = $(event.target).attr('data-type')
		   	if(type == 3){
					goods(event.target.value);
				}else{
					kehu(type,event.target.value);
				}
		  }
		  // Internet Explorer
		  function OnPropChanged (event) {
		      if (event.propertyName.toLowerCase () == "value") {
		        var type = $(event.target).attr('data-type')
		        if(type == 3){
							goods(event.target.value);
						}else{
							kehu(type,event.target.value);
						}
		      }
		  } 
		</script>

	</body>

</html>